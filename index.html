<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‚¬ì„œêµì‚¬-êµê³¼êµì‚¬ í˜‘ë ¥ìˆ˜ì—… ì„¤ê³„ë„êµ¬(ì¤‘í•™êµ)</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap"
        rel="stylesheet">

    <!-- Data Source -->
    <script src="./data/standards_data.js"></script>

    <style>
        :root {
            --primary-color: #6366f1;
            /* Indigo 500 */
            --primary-hover: #4f46e5;
            /* Indigo 600 */
            --secondary-color: #10b981;
            /* Emerald 500 */
            --accent-color: #f59e0b;
            /* Amber 500 */
            --bg-color: #f8fafc;
            /* Slate 50 */
            --card-bg: #ffffff;
            --text-main: #1e293b;
            /* Slate 800 */
            --text-sub: #64748b;
            /* Slate 500 */
            --border-color: #e2e8f0;
            /* Slate 200 */
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }

        .copyright {
            position: fixed;
            top: 15px;
            right: 25px;
            font-size: 0.9rem;
            font-weight: bold;
            color: #ffffff;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            pointer-events: none;
        }

        @media print {
            .copyright {
                position: absolute;
                top: 0;
                right: 0;
            }
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-hover));
            color: white;
            padding: 2rem 1rem;
            text-align: center;
            box-shadow: var(--shadow-md);
        }

        header h1 {
            margin: 0;
            font-size: 2rem;
            font-weight: 700;
        }

        header p {
            margin: 0.5rem 0 0;
            opacity: 0.9;
        }

        /* Layout Wrapper */
        .main-wrapper {
            display: grid;
            grid-template-columns: 260px 1fr;
            max-width: 1300px;
            margin: 0 auto;
            gap: 2rem;
            padding: 0 1rem;
        }

        /* Sidebar */
        .sidebar {
            padding: 2rem 0;
        }

        .sidebar-card {
            background-color: var(--card-bg);
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 2rem;
        }

        .sidebar-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 1.2rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--border-color);
            display: block;
            text-align: center;
        }

        .ref-link {
            display: block;
            padding: 0.8rem;
            background-color: #f1f5f9;
            color: var(--text-main);
            text-decoration: none;
            border-radius: 0.5rem;
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 0.75rem;
            transition: all 0.2s;
            border: 1px solid transparent;
        }

        .ref-link:hover {
            background-color: var(--primary-color);
            color: white;
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }

        .ref-link span {
            display: block;
            font-size: 0.75rem;
            opacity: 0.8;
            margin-bottom: 2px;
        }

        /* Main Container */
        .container {
            width: 100%;
            padding: 2rem 0;
            max-width: 1000px;
        }

        @media (max-width: 1100px) {
            .main-wrapper {
                grid-template-columns: 1fr;
                gap: 0;
            }

            .sidebar {
                padding-bottom: 0;
            }

            .sidebar-card {
                position: static;
            }
        }

        .sidebar-footer {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
            text-align: center;
        }

        .btn-admin {
            background-color: #f1f5f9;
            color: var(--text-sub);
            border: 1px dashed var(--border-color);
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
            border-radius: 0.4rem;
            cursor: pointer;
            width: 100%;
            transition: all 0.2s;
        }

        .btn-admin:hover {
            background-color: #e2e8f0;
            color: var(--text-main);
            border-color: var(--text-sub);
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            backdrop-filter: blur(2px);
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            width: 100%;
            max-width: 500px;
            box-shadow: var(--shadow-lg);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 0.8rem;
        }

        .link-item-edit {
            background: #f8fafc;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            border: 1px solid var(--border-color);
        }

        .manage-list {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 1.5rem;
        }

        .btn-danger {
            background-color: #fee2e2;
            color: #b91c1c;
            border: none;
            padding: 0.3rem 0.6rem;
            border-radius: 0.3rem;
            font-size: 0.75rem;
            cursor: pointer;
        }

        .btn-danger:hover {
            background-color: #fecaca;
        }

        /* Wizard Progress */
        .wizard-progress {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
            position: relative;
        }

        .wizard-progress::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            height: 4px;
            width: 100%;
            background-color: var(--border-color);
            z-index: 0;
            transform: translateY(-50%);
        }

        .step-indicator {
            position: relative;
            z-index: 1;
            background-color: var(--bg-color);
            padding: 0 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--border-color);
            color: var(--text-sub);
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            transition: all 0.3s ease;
            border: 2px solid var(--bg-color);
        }

        .step-indicator.active .step-circle {
            background-color: var(--primary-color);
            color: white;
            transform: scale(1.1);
        }

        .step-indicator.completed .step-circle {
            background-color: var(--secondary-color);
            color: white;
        }

        .step-label {
            margin-top: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-sub);
        }

        .step-indicator.active .step-label {
            color: var(--primary-color);
            font-weight: 700;
        }

        /* Step Content */
        .step-content {
            background-color: var(--card-bg);
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: var(--shadow-lg);
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .step-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h2 {
            color: var(--primary-color);
            margin-top: 0;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-main);
        }

        select,
        input[type="text"],
        textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            font-size: 1rem;
            font-family: inherit;
            transition: border-color 0.2s;
            box-sizing: border-box;
            /* Fix padding issue */
        }

        select:focus,
        input[type="text"]:focus,
        textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        /* Standard Cards */
        .standard-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            background-color: #f9fafb;
            /* Slate 50 */
        }

        .standard-item {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .standard-item:last-child {
            border-bottom: none;
        }

        .standard-item:hover {
            background-color: #e0e7ff;
            /* Indigo 100 */
        }

        .standard-item.selected {
            background-color: #c7d2fe;
            /* Indigo 200 */
            border-left: 4px solid var(--primary-color);
        }

        .code-badge {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        /* Chips for Context */
        .chip-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .chip {
            padding: 0.5rem 1rem;
            background-color: #e2e8f0;
            border-radius: 9999px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .chip:hover {
            background-color: #cbd5e1;
        }

        .chip.selected {
            background-color: var(--accent-color);
            color: white;
        }

        /* Navigation Buttons */
        .btn-container {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-prev {
            background-color: #cbd5e1;
            /* Slate 300 */
            color: var(--text-main);
        }

        .btn-prev:hover {
            background-color: #94a3b8;
            /* Slate 400 */
        }

        .btn-next {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-next:hover {
            background-color: var(--primary-hover);
            transform: translateY(-1px);
        }

        .btn-print {
            background-color: var(--secondary-color);
            color: white;
        }

        .btn-print:hover {
            background-color: #059669;
        }

        /* Summary Box in Step 4 */
        .summary-box {
            background-color: #f1f5f9;
            padding: 1.5rem;
            border-radius: 0.5rem;
            margin-bottom: 2rem;
            border-left: 4px solid var(--secondary-color);
        }

        .summary-item {
            margin-bottom: 1rem;
        }

        .summary-label {
            font-weight: bold;
            color: var(--text-sub);
            font-size: 0.85rem;
            text-transform: uppercase;
        }

        .summary-content {
            font-size: 1.1rem;
            color: var(--text-main);
        }

        /* Design Grid in Step 4 */
        .design-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }

        @media (min-width: 768px) {
            .design-grid {
                grid-template-columns: 1fr 1fr;
            }

            .full-width {
                grid-column: span 2;
            }
        }

        /* Print Styles */
        @media print {
            body {
                background-color: white;
            }

            header,
            .wizard-progress,
            .btn-container,
            .sidebar {
                display: none !important;
            }

            .main-wrapper {
                display: block;
                margin: 0;
                padding: 0;
                max-width: none;
            }

            .step-content {
                box-shadow: none;
                border: none;
                padding: 0;
                display: none !important;
                /* Hide unnecessary steps by default */
                margin-bottom: 2rem;
            }

            /* Conditional visibility based on print mode */
            body.print-step-4 #step4,
            body.print-step-5 #step5,
            body.print-step-6 #step6,
            body.print-all #step4,
            body.print-all #step5,
            body.print-all #step6 {
                display: block !important;
            }

            body.print-all .step-content {
                page-break-before: always;
            }

            body.print-all #step4 {
                page-break-before: avoid;
            }

            textarea,
            input[type="text"] {
                border: 1px solid #eee !important;
                resize: none;
                font-family: inherit;
                background: transparent !important;
                color: black !important;
                height: auto !important;
                /* Allow height to be driven by JS or content */
            }

            .summary-box {
                border: 1px solid #818cf8;
                background-color: #f8fafc !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            table {
                page-break-inside: auto;
                /* Allow table to split across pages */
                border-collapse: collapse !important;
                table-layout: fixed;
                /* Keep column widths stable */
            }

            tr {
                page-break-inside: avoid;
                /* Avoid breaking in middle of a row */
            }

            th,
            td {
                border: 1px solid #bfdbfe !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
                word-break: break-all;
            }
        }

        /* Export Only Styles */
        .export-only {
            display: none;
        }

        .no-export {
            display: inline-block;
        }

        /* When exporting, we will swap these */
        .exporting .no-export {
            display: none !important;
        }

        .exporting .export-only {
            display: block !important;
        }
    </style>
</head>

<body>
    <div class="copyright">â’¸ ë°•ë³´ê²½ 2026</div>
    <header>
        <h1>ì‚¬ì„œêµì‚¬-êµê³¼êµì‚¬ í˜‘ë ¥ìˆ˜ì—… ì„¤ê³„ë„êµ¬(ì¤‘í•™êµ)</h1>
        <p>ì„±ì·¨ê¸°ì¤€ ê¸°ë°˜ í•™êµë„ì„œê´€-êµê³¼ ìœµí•© ìˆ˜ì—… ë””ìì¸</p>
        <p style="font-size: 0.9rem; margin-top: 0.3rem; opacity: 0.8;">(ëŒ€ìƒê³¼ëª© : êµ­ì–´, ì˜ì–´, ì¼ë°˜ì‚¬íšŒ, ì§€ë¦¬, ê³¼í•™, ë„ë•, ë¯¸ìˆ , ì§„ë¡œ)</p>
    </header>

    <div class="main-wrapper">
        <aside class="sidebar">
            <div class="sidebar-card">
                <span class="sidebar-title">ì°¸ê³ ë§í¬</span>

                <div id="dynamicLinks">
                    <!-- Links will be rendered here -->
                </div>

                <div class="sidebar-footer">
                    <button class="btn-admin" onclick="openAdminModal()">âš™ï¸ ë§í¬ ê´€ë¦¬</button>
                </div>
            </div>
        </aside>

        <div class="container">
            <!-- Wizard Progress -->
            <div class="wizard-progress">
                <div class="step-indicator active" id="ind-1">
                    <div class="step-circle">1</div>
                    <div class="step-label">êµê³¼ ì„ íƒ</div>
                </div>
                <div class="step-indicator" id="ind-2">
                    <div class="step-circle">2</div>
                    <div class="step-label">ë„ì„œê´€ ì„ íƒ</div>
                </div>
                <div class="step-indicator" id="ind-3">
                    <div class="step-circle">3</div>
                    <div class="step-label">ë§¥ë½ ì„¤ì •</div>
                </div>
                <div class="step-indicator" id="ind-4">
                    <div class="step-circle">4</div>
                    <div class="step-label">ìˆ˜ì—… ì„¤ê³„</div>
                </div>
                <div class="step-indicator" id="ind-5">
                    <div class="step-circle">5</div>
                    <div class="step-label">ê³¼ì œ ì„¤ê³„</div>
                </div>
                <div class="step-indicator" id="ind-6">
                    <div class="step-circle">6</div>
                    <div class="step-label">í‰ê°€ ë£¨ë¸Œë¦­</div>
                </div>
            </div>

            <!-- Step 1: Subject Selection -->
            <div class="step-content active" id="step1">
                <h2>1. êµê³¼ ì„±ì·¨ê¸°ì¤€ ì„ íƒ</h2>
                <div class="form-group">
                    <label for="subjectSelect">êµê³¼ëª© ì„ íƒ</label>
                    <select id="subjectSelect" onchange="renderSubjectStandards()">
                        <option value="">êµê³¼ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                        <!-- Options populated by JS -->
                    </select>
                </div>

                <div class="form-group">
                    <label>ì„±ì·¨ê¸°ì¤€ ëª©ë¡ (í´ë¦­í•˜ì—¬ ì„ íƒ)</label>
                    <div class="standard-list" id="subjectStandardsList">
                        <div style="padding:1rem; color:#888;">êµê³¼ë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.</div>
                    </div>
                </div>

                <div class="btn-container">
                    <div></div> <!-- Spacer -->
                    <button class="btn btn-next" onclick="nextStep(2)">ë‹¤ìŒ ë‹¨ê³„ &rightarrow;</button>
                </div>
            </div>

            <!-- Step 2: Library Standard Selection -->
            <div class="step-content" id="step2">
                <h2>2. í•™êµë„ì„œê´€ ì„±ì·¨ê¸°ì¤€ ì„ íƒ (ë„ì •)</h2>
                <div class="form-group">
                    <label>ì •ë³´í™œë™ ì„±ì·¨ê¸°ì¤€ ëª©ë¡ (í´ë¦­í•˜ì—¬ ì„ íƒ)</label>
                    <div class="standard-list" id="libStandardsList">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <div class="btn-container">
                    <button class="btn btn-prev" onclick="prevStep(1)">&leftarrow; ì´ì „</button>
                    <button class="btn btn-next" onclick="nextStep(3)">ë‹¤ìŒ ë‹¨ê³„ &rightarrow;</button>
                </div>
            </div>

            <!-- Step 3: Context Definition -->
            <div class="step-content" id="step3">
                <h2>3. ì‚¶ì˜ ë§¥ë½ ì„¤ì •</h2>
                <p style="color:var(--text-sub); margin-bottom:1.5rem;">ìˆ˜ì—…ì´ í•™ìƒë“¤ì˜ ì‹¤ì œ ì‚¶ê³¼ ì—°ê²°ë˜ë„ë¡ ë°°ê²½ ë§¥ë½ì„ ì„¤ì •í•©ë‹ˆë‹¤.</p>

                <div class="form-group">
                    <label>ì¶”ì²œ ë§¥ë½ í‚¤ì›Œë“œ (ì„ íƒ ê°€ëŠ¥)</label>
                    <div class="chip-container" id="contextChips">
                        <div class="chip" onclick="selectContext('ê°œì¸ê³¼ ì‚¬íšŒì˜ ê³µë™ í–‰ë³µ')">ê°œì¸ê³¼ ì‚¬íšŒì˜ ê³µë™ í–‰ë³µ</div>
                        <div class="chip" onclick="selectContext('ì •ì²´ì„±ê³¼ ìê¸°ì£¼ë„ì„±')">ì •ì²´ì„±ê³¼ ìê¸°ì£¼ë„ì„±</div>
                        <div class="chip" onclick="selectContext('ë³´í¸ì  ì‚¬íšŒë³µì§€')">ë³´í¸ì  ì‚¬íšŒë³µì§€</div>
                        <div class="chip" onclick="selectContext('í¬ìš©ë ¥ê³¼ ì´í•´ë ¥')">í¬ìš©ë ¥ê³¼ ì´í•´ë ¥</div>
                        <div class="chip" onclick="selectContext('ê³µê°ê³¼ ìƒí˜¸ í˜‘ë ¥')">ê³µê°ê³¼ ìƒí˜¸ í˜‘ë ¥</div>
                        <div class="chip" onclick="selectContext('ìƒíƒœ ì „í™˜ê³¼ ê¸°í›„ ë³€í™”')">ìƒíƒœ ì „í™˜ê³¼ ê¸°í›„ ë³€í™”</div>
                        <div class="chip" onclick="selectContext('ë””ì§€í„¸ ì „í™˜ê³¼ AI')">ë””ì§€í„¸ ì „í™˜ê³¼ AI</div>
                        <div class="chip" onclick="selectContext('ì±…ì„ ìˆëŠ” ë¯¼ì£¼ì‹œë¯¼')">ì±…ì„ ìˆëŠ” ë¯¼ì£¼ì‹œë¯¼</div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="customContext">ìˆ˜ì—… ë§¥ë½ / ì£¼ì œ ê¸°ìˆ </label>
                    <input type="text" id="customContext" placeholder="ì˜ˆ: ìƒì„±í˜• AIë¥¼ í™œìš©í•œ ë‚˜ë§Œì˜ ì§„ë¡œ ë¡œë“œë§µ ì„¤ê³„">
                </div>

                <div class="btn-container">
                    <button class="btn btn-prev" onclick="prevStep(2)">&leftarrow; ì´ì „</button>
                    <button class="btn btn-next" onclick="nextStep(4)">ì„¤ê³„ ì‹œì‘ &rightarrow;</button>
                </div>
            </div>

            <!-- Step 4: Deep Lesson Design -->
            <div class="step-content" id="step4">
                <h2>4. ê¹Šì´ ìˆëŠ” ìˆ˜ì—… ì„¤ê³„ (Deep Lesson Design)</h2>

                <!-- Selected Standards Summary -->
                <div class="summary-box">
                    <div class="summary-item">
                        <div class="summary-label">ì„ íƒëœ êµê³¼ ì„±ì·¨ê¸°ì¤€</div>
                        <div class="summary-content" id="summarySubject">...</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">ì„ íƒëœ ë„ì„œê´€ ì„±ì·¨ê¸°ì¤€</div>
                        <div class="summary-content" id="summaryLib">...</div>
                    </div>
                    <div class="summary-item" style="margin-bottom:0;">
                        <div class="summary-label">ì‚¶ì˜ ë§¥ë½</div>
                        <div class="summary-content" id="summaryContext">...</div>
                    </div>
                </div>

                <div class="design-grid">
                    <div class="form-group full-width">
                        <label for="lessonTitle">ìˆ˜ì—… ì œëª©</label>
                        <input type="text" id="lessonTitle" placeholder="ì°½ì˜ì ì¸ ìˆ˜ì—… ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                </div>

                <!-- Unit Design Section -->
                <div
                    style="background-color: #f0fdf4; padding: 1.5rem; border-radius: 0.5rem; margin-top: 1.5rem; border: 1px solid #bbf7d0;">
                    <h3
                        style="color: #15803d; margin-top: 0; border-bottom: 1px solid #bbf7d0; padding-bottom: 0.5rem;">
                        â… .
                        ë‹¨ì› ìˆ˜ì—… ì„¤ê³„ (Unit Design)</h3>

                    <div class="design-grid">
                        <div class="form-group">
                            <label for="bigIdeaLib">í•µì‹¬ ì•„ì´ë””ì–´ - ë„ì„œê´€ê³¼ ì •ë³´ìƒí™œ</label>
                            <textarea id="bigIdeaLib" placeholder="ë„ì„œê´€ê³¼ ì •ë³´ìƒí™œ ë‹¨ì›ì˜ í•µì‹¬ ê°œë…"
                                style="min-height: 80px;"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="bigIdeaSub">í•µì‹¬ ì•„ì´ë””ì–´ - í˜‘ë ¥êµê³¼</label>
                            <textarea id="bigIdeaSub" placeholder="í˜‘ë ¥êµê³¼ ë‹¨ì›ì˜ í•µì‹¬ ê°œë…" style="min-height: 80px;"></textarea>
                        </div>
                    </div>

                    <div class="design-grid">
                        <div class="form-group full-width">
                            <label>ë‚´ìš© ìš”ì†Œ (Content Elements)</label>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                                <!-- Library Side -->
                                <div
                                    style="background-color: white; padding: 1rem; border-radius: 0.5rem; border: 1px solid #bbf7d0;">
                                    <div
                                        style="font-weight: bold; margin-bottom: 0.75rem; color: #15803d; border-bottom: 1px solid #f0fdf4;">
                                        â‘  ë„ì„œê´€ê³¼ ì •ë³´ìƒí™œ</div>
                                    <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                                        <input type="text" id="contentKnowledgeLib" placeholder="ì§€ì‹Â·ì´í•´ (ë„ì„œê´€)">
                                        <input type="text" id="contentProcessLib" placeholder="ê³¼ì •Â·ê¸°ëŠ¥ (ë„ì„œê´€)">
                                        <input type="text" id="contentValueLib" placeholder="ê°€ì¹˜Â·íƒœë„ (ë„ì„œê´€)">
                                    </div>
                                </div>
                                <!-- Subject Side -->
                                <div
                                    style="background-color: white; padding: 1rem; border-radius: 0.5rem; border: 1px solid #bbf7d0;">
                                    <div
                                        style="font-weight: bold; margin-bottom: 0.75rem; color: #15803d; border-bottom: 1px solid #f0fdf4;">
                                        â‘¡ í˜‘ë ¥êµê³¼</div>
                                    <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                                        <input type="text" id="contentKnowledgeSub" placeholder="ì§€ì‹Â·ì´í•´ (êµê³¼)">
                                        <input type="text" id="contentProcessSub" placeholder="ê³¼ì •Â·ê¸°ëŠ¥ (êµê³¼)">
                                        <input type="text" id="contentValueSub" placeholder="ê°€ì¹˜Â·íƒœë„ (êµê³¼)">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group full-width">
                            <label for="graspsTask">í‰ê°€ ê³¼ì œ (GRASPS)</label>
                            <textarea id="graspsTask"
                                placeholder="í•™ìƒë“¤ì´ ìˆ˜í–‰í•´ì•¼ í•  ì‹¤ì œì ì¸ ê³¼ì œëŠ” ë¬´ì—‡ì¸ê°€? (Goal, Role, Audience, Situation, Product, Standards)"
                                style="min-height: 100px;"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Session Design Section -->
                <div
                    style="background-color: #eff6ff; padding: 1.5rem; border-radius: 0.5rem; margin-top: 1.5rem; border: 1px solid #bfdbfe;">
                    <h3
                        style="color: #1d4ed8; margin-top: 0; border-bottom: 1px solid #bfdbfe; padding-bottom: 0.5rem;">
                        â…¡.
                        ì°¨ì‹œë³„ ì„¸ë¶€ ì„¤ê³„ (Session Design)</h3>

                    <div class="design-grid">
                        <div class="form-group">
                            <label for="instructionalIntent">ìˆ˜ì—… ì˜ë„ (Instructional Intent)</label>
                            <textarea id="instructionalIntent" placeholder="ì´ ìˆ˜ì—…ì„ í†µí•´ í•™ìƒë“¤ì´ ë¬´ì—‡ì„ ê²½í—˜í•˜ê³  ë°°ìš°ê¸°ë¥¼ ë°”ë¼ëŠ”ê°€?"
                                style="min-height: 435px;"></textarea>
                        </div>
                        <div class="form-group">
                            <label>íƒêµ¬ ì§ˆë¬¸ (Inquiry Question)</label>
                            <div style="display: flex; flex-direction: column; gap: 1rem;">
                                <!-- Factual Slot -->
                                <div
                                    style="background-color: #fff; border: 1px solid #bfdbfe; border-radius: 0.5rem; padding: 1rem; box-shadow: var(--shadow-sm);">
                                    <div
                                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                        <span style="font-weight: bold; color: #1d4ed8; font-size: 0.9rem;">â‘  ì‚¬ì‹¤ì  ì§ˆë¬¸
                                            (Factual)</span>
                                        <button class="btn"
                                            style="padding: 0.2rem 0.6rem; font-size: 0.75rem; background-color: #3b82f6; color: white;"
                                            onclick="generateSpecificQuestion('factual')">ğŸª„ ìƒì„±</button>
                                    </div>
                                    <textarea id="qFactual" placeholder="ì‚¬ì‹¤ì  ì§ˆë¬¸ì„ ì…ë ¥í•˜ê±°ë‚˜ ìƒì„±í•˜ì„¸ìš”."
                                        style="min-height: 60px; font-size: 0.9rem;"></textarea>
                                </div>

                                <!-- Conceptual Slot -->
                                <div
                                    style="background-color: #fff; border: 1px solid #bfdbfe; border-radius: 0.5rem; padding: 1rem; box-shadow: var(--shadow-sm);">
                                    <div
                                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                        <span style="font-weight: bold; color: #1d4ed8; font-size: 0.9rem;">â‘¡ ê°œë…ì  ì§ˆë¬¸
                                            (Conceptual)</span>
                                        <button class="btn"
                                            style="padding: 0.2rem 0.6rem; font-size: 0.75rem; background-color: #3b82f6; color: white;"
                                            onclick="generateSpecificQuestion('conceptual')">ğŸª„ ìƒì„±</button>
                                    </div>
                                    <textarea id="qConceptual" placeholder="ê°œë…ì  ì§ˆë¬¸ì„ ì…ë ¥í•˜ê±°ë‚˜ ìƒì„±í•˜ì„¸ìš”."
                                        style="min-height: 60px; font-size: 0.9rem;"></textarea>
                                </div>

                                <!-- Controversial Slot -->
                                <div
                                    style="background-color: #fff; border: 1px solid #bfdbfe; border-radius: 0.5rem; padding: 1rem; box-shadow: var(--shadow-sm);">
                                    <div
                                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                        <span style="font-weight: bold; color: #1d4ed8; font-size: 0.9rem;">â‘¢ ë…¼ìŸì  ì§ˆë¬¸
                                            (Controversial)</span>
                                        <button class="btn"
                                            style="padding: 0.2rem 0.6rem; font-size: 0.75rem; background-color: #3b82f6; color: white;"
                                            onclick="generateSpecificQuestion('controversial')">ğŸª„ ìƒì„±</button>
                                    </div>
                                    <textarea id="qControversial" placeholder="ë…¼ìŸì  ì§ˆë¬¸ì„ ì…ë ¥í•˜ê±°ë‚˜ ìƒì„±í•˜ì„¸ìš”."
                                        style="min-height: 60px; font-size: 0.9rem;"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>ê¹Šì´ìˆëŠ” ìˆ˜ì—… ê³¼ì •ì•ˆ (Process Plan)</label>
                        <div style="overflow-x: auto;">
                            <table id="processTable"
                                style="width: 100%; border-collapse: collapse; border: 1px solid #bfdbfe; font-size: 0.9rem;">
                                <thead>
                                    <tr style="background-color: #818cf8; color: white;">
                                        <th rowspan="2" style="border: 1px solid #bfdbfe; padding: 0.5rem; width: 8%;">
                                            ì°¨ì‹œ
                                        </th>
                                        <th colspan="3" style="border: 1px solid #bfdbfe; padding: 0.5rem;">íƒêµ¬-ì‹¤í–‰-ì„±ì°°ì˜ ê³¼ì •
                                        </th>
                                        <th rowspan="2" class="no-export"
                                            style="border: 1px solid #bfdbfe; padding: 0.5rem; width: 5%;">
                                            ê´€ë¦¬</th>
                                    </tr>
                                    <tr style="background-color: #a5b4fc; color: white;">
                                        <th style="border: 1px solid #bfdbfe; padding: 0.5rem; width: 29%;">íƒêµ¬Â·ì‹¤í–‰Â·ì„±ì°°ì„ ìœ„í•œ
                                            ìˆ˜ì—… í™œë™</th>
                                        <th style="border: 1px solid #bfdbfe; padding: 0.5rem; width: 29%;">ìˆ˜ì—…ë°©ë²•</th>
                                        <th style="border: 1px solid #bfdbfe; padding: 0.5rem; width: 29%;">ìˆ˜ì—…Â·í‰ê°€ ì—°ê³„ì˜
                                            ì£¼ì•ˆì </th>
                                    </tr>
                                </thead>
                                <tbody id="processTableBody">
                                    <tr>
                                        <td class="session-number"
                                            style="border: 1px solid #bfdbfe; text-align: center; font-weight: bold; background-color: #f8fafc;">
                                            1</td>
                                        <td style="border: 1px solid #bfdbfe; padding: 0;">
                                            <textarea class="cycle-activities"
                                                placeholder="[ìˆ˜ì—… í™œë™] ì‚¬ì‹¤ì  ì§ˆë¬¸, ì‘í’ˆ ê°ìƒ, ë‚´ìš© ì •ë¦¬ ë“±"
                                                style="width: 100%; border: none; min-height: 120px; padding: 0.5rem; resize: vertical; display: block;"></textarea>
                                        </td>
                                        <td style="border: 1px solid #bfdbfe; padding: 0;">
                                            <textarea class="cycle-methods" placeholder="[ìˆ˜ì—…ë°©ë²•] í˜‘ë™í•™ìŠµ, í”„ë¡œì íŠ¸ ê¸°ë°˜ í•™ìŠµ ë“±"
                                                style="width: 100%; border: none; min-height: 120px; padding: 0.5rem; resize: vertical; display: block;"></textarea>
                                        </td>
                                        <td style="border: 1px solid #bfdbfe; padding: 0;">
                                            <textarea class="cycle-focus" placeholder="[ì£¼ì•ˆì ] ì§„ë‹¨í‰ê°€, ì„±ì·¨ê¸°ì¤€ ì—°ê³„, ê²½í—˜ íŒŒì•… ë“±"
                                                style="width: 100%; border: none; min-height: 120px; padding: 0.5rem; resize: vertical; display: block;"></textarea>
                                        </td>
                                        <td class="no-export"
                                            style="border: 1px solid #bfdbfe; text-align: center; background-color: #f8fafc;">
                                            -
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <button type="button" class="btn"
                            style="width: 100%; margin-top: 0.5rem; background-color: #818cf8; color: white;"
                            onclick="addSessionRow()">+ ì°¨ì‹œ ì¶”ê°€</button>
                    </div>

                    <div class="form-group">
                        <label>ìˆ˜ì—… ë‹¨ê³„ (Steps)</label>
                        <div
                            style="border: 1px solid var(--border-color); border-radius: 0.5rem; padding: 1rem; background-color: white;">
                            <div style="margin-bottom: 1rem;">
                                <label style="font-size: 0.9rem; color: var(--text-sub);">ë„ì… (Introduction)</label>
                                <input type="text" id="stepIntro" placeholder="ë™ê¸° ìœ ë°œ, ì „ì‹œ í•™ìŠµ ìƒê¸°, ìˆ˜ì—… ëª©í‘œ í™•ì¸">
                            </div>
                            <div style="margin-bottom: 1rem;">
                                <label style="font-size: 0.9rem; color: var(--text-sub);">ì „ê°œ (Development)</label>
                                <textarea id="stepDev" placeholder="ì£¼ìš” í•™ìŠµ í™œë™, í•™ìƒ ì°¸ì—¬, êµì‚¬ ì§€ì›"
                                    style="min-height: 120px;"></textarea>
                            </div>
                            <div>
                                <label style="font-size: 0.9rem; color: var(--text-sub);">ì •ë¦¬ (Conclusion)</label>
                                <input type="text" id="stepConcl" placeholder="í•™ìŠµ ë‚´ìš© ì •ë¦¬, ì°¨ì‹œ ì˜ˆê³ , ê³¼ì œ ì œì‹œ">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="btn-container">
                    <button class="btn btn-prev" onclick="prevStep(3)">&leftarrow; ì´ì „ ë‹¨ê³„</button>
                    <button class="btn btn-print" style="margin: 0 0.5rem; background-color: #818cf8;"
                        onclick="printStep(4)">ğŸ–¨ 4ë‹¨ê³„ ì¸ì‡„</button>
                    <button class="btn btn-next" onclick="nextStep(5)">ê¸°ë³¸ ê³¼ì • ì„¤ê³„ ì™„ë£Œ (5ë‹¨ê³„ë¡œ) &rightarrow;</button>
                </div>
            </div>

            <!-- Step 5: GRASPS Assessment Generator -->
            <div class="step-content" id="step5">
                <h2>5. ê³¼ì œ ì„¤ê³„ (GRASPS)</h2>
                <p style="color:var(--text-sub); margin-bottom:1.5rem;">ì„±ì·¨ê¸°ì¤€ì„ ë°”íƒ•ìœ¼ë¡œ ì‹¤ì œì ì¸ ìˆ˜í–‰í‰ê°€ ê³¼ì œë¥¼ ë””ìì¸í•©ë‹ˆë‹¤.</p>

                <div class="no-export"
                    style="margin-bottom: 2rem; padding: 1rem; background-color: #fef3c7; border: 1px solid #fcd34d; border-radius: 0.5rem; display: flex; align-items: center; justify-content: space-between;">
                    <div>
                        <strong style="color: #92400e;">ğŸª„ GRASPS ìë™ ìƒì„±ê¸°</strong>
                        <div style="font-size: 0.85rem; color: #b45309;">ì„ íƒí•œ ì„±ì·¨ê¸°ì¤€ì„ ë§¥ë½ì— ë§ê²Œ ì¡°í•©í•˜ì—¬ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ êµ¬ì„±í•©ë‹ˆë‹¤.</div>
                    </div>
                    <button class="btn" style="background-color: var(--accent-color); color: white;"
                        onclick="generateGRASPS()">ì‹œë‚˜ë¦¬ì˜¤ ìƒì„±í•˜ê¸°</button>
                </div>

                <div class="design-grid">
                    <div class="form-group">
                        <label for="g_goal">ëª©í‘œ (Goal)</label>
                        <textarea id="g_goal" placeholder="ë¬¸ì œë¥¼ í•´ê²°í•˜ê±°ë‚˜ ë„ì „í•  ì‹¤ì œ ìƒí™©ì˜ ëª©í‘œ"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="g_role">ì—­í•  (Role)</label>
                        <textarea id="g_role" placeholder="í•™ìŠµìê°€ ë§¡ê²Œ ë˜ëŠ” ì‹¤ì œ ìƒí™© ì†ì˜ ì—­í• "></textarea>
                    </div>
                    <div class="form-group">
                        <label for="g_audience">ì²­ì¤‘ (Audience)</label>
                        <textarea id="g_audience" placeholder="ê²°ê³¼ë¬¼ì„ ì „ë‹¬ë°›ê±°ë‚˜ í‰ê°€í•  ì‹¤ì œ ëŒ€ìƒ"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="g_situation">ìƒí™© (Situation)</label>
                        <textarea id="g_situation" placeholder="ë„ì „ì´ ë°œìƒí•˜ëŠ” êµ¬ì²´ì ì¸ ë°°ê²½ê³¼ ë§¥ë½"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="g_product">ì‚°ì¶œë¬¼ (Product)</label>
                        <textarea id="g_product" placeholder="í•™ìŠµìê°€ ìµœì¢…ì ìœ¼ë¡œ ë§Œë“¤ì–´ë‚¼ ê²°ê³¼ë¬¼"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="g_standards">ê¸°ì¤€ (Standards)</label>
                        <textarea id="g_standards" placeholder="ì„±ê³µì ì¸ ìˆ˜í–‰ì„ íŒë‹¨í•˜ëŠ” ëª…í™•í•œ ê¸°ì¤€"></textarea>
                    </div>
                </div>

                <div class="btn-container">
                    <button class="btn btn-prev" onclick="prevStep(4)">&leftarrow; ì´ì „ ë‹¨ê³„</button>
                    <button class="btn btn-print" style="margin: 0 0.5rem; background-color: #818cf8;"
                        onclick="printStep(5)">ğŸ–¨ 5ë‹¨ê³„ ì¸ì‡„</button>
                    <button class="btn btn-next" onclick="nextStep(6)">ê³¼ì œ ì„¤ê³„ ì™„ë£Œ (6ë‹¨ê³„ë¡œ) &rightarrow;</button>
                </div>
            </div>

            <!-- Step 6: Rubric Design -->
            <div class="step-content" id="step6">
                <h2>6. í‰ê°€ ë£¨ë¸Œë¦­ ì„¤ê³„ (Rubric Design)</h2>
                <p style="color:var(--text-sub); margin-bottom:1.5rem;">ì„±ì·¨ê¸°ì¤€ì— ë”°ë¥¸ ìˆ˜ì¤€ë³„ ìˆ˜í–‰ ëŠ¥ë ¥ì„ ì •ì˜í•©ë‹ˆë‹¤.</p>

                <div class="no-export"
                    style="margin-bottom: 2rem; padding: 1rem; background-color: #f0f9ff; border: 1px solid #bae6fd; border-radius: 0.5rem; display: flex; align-items: center; justify-content: space-between;">
                    <div>
                        <strong style="color: #0369a1;">ğŸª„ ë£¨ë¸Œë¦­ ìë™ ìƒì„±ê¸°</strong>
                        <div style="font-size: 0.85rem; color: #0c4a6e;">ì§€ì‹, ê³¼ì •, íƒœë„ ì°¨ì›ì˜ ë£¨ë¸Œë¦­ì„ ì„±ì·¨ê¸°ì¤€ ê¸°ë°˜ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤.</div>
                    </div>
                    <button class="btn" style="background-color: #0ea5e9; color: white;" onclick="generateRubric()">ë£¨ë¸Œë¦­
                        ìƒì„±í•˜ê¸°</button>
                </div>

                <div class="rubric-container" style="overflow-x: auto;">
                    <table
                        style="width: 100%; border-collapse: collapse; background-color: white; border: 1px solid var(--border-color);">
                        <thead>
                            <tr style="background-color: #f8fafc;">
                                <th style="border: 1px solid var(--border-color); padding: 0.75rem; width: 20%;">í‰ê°€ ìš”ì†Œ
                                    (Criteria)</th>
                                <th style="border: 1px solid var(--border-color); padding: 0.75rem; width: 26%;">ìƒ
                                    (High)
                                </th>
                                <th style="border: 1px solid var(--border-color); padding: 0.75rem; width: 26%;">ì¤‘ (Mid)
                                </th>
                                <th style="border: 1px solid var(--border-color); padding: 0.75rem; width: 26%;">í•˜ (Low)
                                </th>
                            </tr>
                        </thead>
                        <tbody id="rubricTableBody">
                            <tr>
                                <td
                                    style="border: 1px solid var(--border-color); padding: 0.75rem; font-weight: bold; background-color: #f1f5f9;">
                                    ì§€ì‹Â·ì´í•´</td>
                                <td style="border: 1px solid var(--border-color); padding: 0;"><textarea id="rubricK_H"
                                        style="width:100%; border:none; height:120px; padding:0.5rem; resize:vertical;"></textarea>
                                </td>
                                <td style="border: 1px solid var(--border-color); padding: 0;"><textarea id="rubricK_M"
                                        style="width:100%; border:none; height:120px; padding:0.5rem; resize:vertical;"></textarea>
                                </td>
                                <td style="border: 1px solid var(--border-color); padding: 0;"><textarea id="rubricK_L"
                                        style="width:100%; border:none; height:120px; padding:0.5rem; resize:vertical;"></textarea>
                                </td>
                            </tr>
                            <tr>
                                <td
                                    style="border: 1px solid var(--border-color); padding: 0.75rem; font-weight: bold; background-color: #f1f5f9;">
                                    ê³¼ì •Â·ê¸°ëŠ¥</td>
                                <td style="border: 1px solid var(--border-color); padding: 0;"><textarea id="rubricS_H"
                                        style="width:100%; border:none; height:120px; padding:0.5rem; resize:vertical;"></textarea>
                                </td>
                                <td style="border: 1px solid var(--border-color); padding: 0;"><textarea id="rubricS_M"
                                        style="width:100%; border:none; height:120px; padding:0.5rem; resize:vertical;"></textarea>
                                </td>
                                <td style="border: 1px solid var(--border-color); padding: 0;"><textarea id="rubricS_L"
                                        style="width:100%; border:none; height:120px; padding:0.5rem; resize:vertical;"></textarea>
                                </td>
                            </tr>
                            <tr>
                                <td
                                    style="border: 1px solid var(--border-color); padding: 0.75rem; font-weight: bold; background-color: #f1f5f9;">
                                    ê°€ì¹˜Â·íƒœë„</td>
                                <td style="border: 1px solid var(--border-color); padding: 0;"><textarea id="rubricA_H"
                                        style="width:100%; border:none; height:120px; padding:0.5rem; resize:vertical;"></textarea>
                                </td>
                                <td style="border: 1px solid var(--border-color); padding: 0;"><textarea id="rubricA_M"
                                        style="width:100%; border:none; height:120px; padding:0.5rem; resize:vertical;"></textarea>
                                </td>
                                <td style="border: 1px solid var(--border-color); padding: 0;"><textarea id="rubricA_L"
                                        style="width:100%; border:none; height:120px; padding:0.5rem; resize:vertical;"></textarea>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="btn-container" style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                    <button class="btn btn-prev" onclick="prevStep(5)">&leftarrow; ì´ì „ ë‹¨ê³„</button>
                    <button class="btn btn-print" style="background-color: #818cf8;" onclick="printStep(6)">ğŸ–¨ 6ë‹¨ê³„(ë£¨ë¸Œë¦­)
                        ì¸ì‡„</button>
                    <button class="btn btn-print" style="background-color: #10b981; flex-grow: 1;"
                        onclick="downloadIntegratedPlan()">ğŸ’¾ ì„¤ê³„ì•ˆ í†µí•© ë‹¤ìš´ë¡œë“œ (.html)</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Modal -->
    <div class="modal-overlay" id="adminModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 style="margin:0;">ğŸ”— ì°¸ê³ ë§í¬ ê´€ë¦¬</h3>
                <button onclick="closeAdminModal()"
                    style="border:none; background:none; cursor:pointer; font-size:1.5rem;">&times;</button>
            </div>

            <div class="manage-list" id="manageList">
                <!-- Editable link items -->
            </div>

            <div style="background:#f1f5f9; padding:1rem; border-radius:0.5rem; margin-top:1rem;">
                <h4 style="margin-top:0; font-size:0.9rem;">ìƒˆ ë§í¬ ì¶”ê°€</h4>
                <div style="display:flex; flex-direction:column; gap:0.5rem;">
                    <input type="text" id="newLinkName" placeholder="ì‚¬ì´íŠ¸ ëª…ì¹­ (ì˜ˆ: êµ­ê°€êµìœ¡ê³¼ì •ì„¼í„°)">
                    <input type="text" id="newLinkSub" placeholder="ì„¤ëª… (ì˜ˆ: êµìœ¡ê³¼ì • ì›ë¬¸ ë°ì´í„°)">
                    <input type="text" id="newLinkUrl" placeholder="URL (https://...)">
                    <button class="btn" onclick="addLink()" style="width:100%; margin-top:0.5rem;">ì¶”ê°€í•˜ê¸°</button>
                </div>
            </div>

            <div style="margin-top:1.5rem; text-align:right;">
                <button class="btn" style="background:var(--text-sub);" onclick="closeAdminModal()">ë‹«ê¸°</button>
            </div>
        </div>
    </div>

    <!-- Application Logic -->
    <script>
        // State
        let currentStep = 1;
        let selectedSubject = '';
        let selectedSubjectStd = null;
        let selectedLibStd = null;
        let contextText = '';

        // Reference Links State
        const DEFAULT_LINKS = [
            { name: 'êµ­ê°€êµìœ¡ê³¼ì •ì„¼í„°', sub: 'êµìœ¡ê³¼ì • ì›ë¬¸ ë°ì´í„°', url: 'https://ncic.re.kr/inv/org/list.do' },
            { name: 'í˜‘ë ¥ìˆ˜ì—… ì„±ì·¨ê¸°ì¤€ ì—°ê²°ë§', sub: 'ì‹œê°í™” íƒìƒ‰ ë„êµ¬', url: 'https://wata1593.github.io/test/' },
            { name: 'ì±…ì“°ê¸° ìˆ˜ì—… ë„êµ¬', sub: 'ê¸€ì“°ê¸° êµìœ¡ ì†”ë£¨ì…˜', url: 'https://wata1593.github.io/Student-Author-Project/' }
        ];
        let refLinks = JSON.parse(localStorage.getItem('refLinks')) || DEFAULT_LINKS;

        // Initialization
        window.onload = function () {
            populateSubjectDropdown();
            renderLibraryStandards();
            renderRefLinks();
        };

        // --- Link Management Functions ---
        function renderRefLinks() {
            const container = document.getElementById('dynamicLinks');
            container.innerHTML = refLinks.map((link, idx) => `
                <a href="${link.url}" target="_blank" class="ref-link">
                    <span>${link.sub}</span>
                    ${idx + 1}) ${link.name}
                </a>
            `).join('');
        }

        function openAdminModal() {
            const password = prompt('ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
            if (password === '1593') {
                document.getElementById('adminModal').style.display = 'flex';
                renderManageList();
            } else if (password !== null) {
                alert('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');
            }
        }

        function closeAdminModal() {
            document.getElementById('adminModal').style.display = 'none';
        }

        function renderManageList() {
            const list = document.getElementById('manageList');
            list.innerHTML = refLinks.map((link, idx) => `
                <div class="link-item-edit">
                    <div style="display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:0.5rem;">
                        <span style="font-weight:bold; font-size:0.9rem;">${idx + 1}. ${link.name}</span>
                        <button class="btn-danger" onclick="deleteLink(${idx})">ì‚­ì œ</button>
                    </div>
                    <div style="font-size:0.8rem; color:var(--text-sub); word-break:break-all;">
                        <div>ì„¤ëª…: ${link.sub}</div>
                        <div>URL: ${link.url}</div>
                    </div>
                </div>
            `).join('');
            if (refLinks.length === 0) {
                list.innerHTML = '<p style="text-align:center; color:var(--text-sub); font-size:0.9rem;">ë“±ë¡ëœ ë§í¬ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
        }

        function addLink() {
            const name = document.getElementById('newLinkName').value.trim();
            const sub = document.getElementById('newLinkSub').value.trim();
            const url = document.getElementById('newLinkUrl').value.trim();

            if (!name || !url) {
                alert('ëª…ì¹­ê³¼ URLì€ í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.');
                return;
            }

            refLinks.push({ name, sub, url });
            saveAndRefreshLinks();

            // Clear inputs
            document.getElementById('newLinkName').value = '';
            document.getElementById('newLinkSub').value = '';
            document.getElementById('newLinkUrl').value = '';
        }

        function deleteLink(idx) {
            if (confirm('ì´ ë§í¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                refLinks.splice(idx, 1);
                saveAndRefreshLinks();
            }
        }

        function saveAndRefreshLinks() {
            localStorage.setItem('refLinks', JSON.stringify(refLinks));
            renderRefLinks();
            renderManageList();
        }

        function addSessionRow() {
            const tbody = document.getElementById('processTableBody');
            const rowCount = tbody.rows.length;
            const newRow = document.createElement('tr');

            newRow.innerHTML = `
                <td class="session-number" style="border: 1px solid #bfdbfe; text-align: center; font-weight: bold; background-color: #f8fafc;">
                    ${rowCount + 1}
                </td>
                <td style="border: 1px solid #bfdbfe; padding: 0;">
                    <textarea class="cycle-activities" placeholder="[ìˆ˜ì—… í™œë™]" style="width: 100%; border: none; min-height: 120px; padding: 0.5rem; resize: vertical; display: block;"></textarea>
                </td>
                <td style="border: 1px solid #bfdbfe; padding: 0;">
                    <textarea class="cycle-methods" placeholder="[ìˆ˜ì—…ë°©ë²•]" style="width: 100%; border: none; min-height: 120px; padding: 0.5rem; resize: vertical; display: block;"></textarea>
                </td>
                <td style="border: 1px solid #bfdbfe; padding: 0;">
                    <textarea class="cycle-focus" placeholder="[ì£¼ì•ˆì ]" style="width: 100%; border: none; min-height: 120px; padding: 0.5rem; resize: vertical; display: block;"></textarea>
                </td>
                <td class="no-export" style="border: 1px solid #bfdbfe; text-align: center; background-color: #f8fafc;">
                    <button type="button" class="btn-danger" style="padding: 0.2rem 0.5rem; font-size: 0.8rem;" onclick="removeSessionRow(this)">ì‚­ì œ</button>
                </td>
            `;
            tbody.appendChild(newRow);
        }

        function removeSessionRow(btn) {
            const row = btn.parentNode.parentNode;
            row.parentNode.removeChild(row);

            // Re-index remaining rows
            const rows = document.querySelectorAll('#processTableBody .session-number');
            rows.forEach((td, idx) => {
                td.textContent = idx + 1;
            });
        }

        function populateSubjectDropdown() {
            const select = document.getElementById('subjectSelect');
            // Excluding 'ë„ì„œê´€/ì •ë³´ (ë„ì •)' from subject dropdown as it is separate
            const subjects = Object.keys(standardsData).filter(s => !s.includes('ë„ì„œê´€'));

            subjects.forEach(subject => {
                const opt = document.createElement('option');
                opt.value = subject;
                opt.textContent = subject;
                select.appendChild(opt);
            });
        }

        function renderSubjectStandards() {
            const subject = document.getElementById('subjectSelect').value;
            const container = document.getElementById('subjectStandardsList');
            container.innerHTML = '';

            if (!subject) {
                container.innerHTML = '<div style="padding:1rem; color:#888;">êµê³¼ë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.</div>';
                return;
            }

            const standards = standardsData[subject];
            standards.forEach(std => {
                const el = document.createElement('div');
                el.className = 'standard-item';
                if (selectedSubjectStd && selectedSubjectStd.code === std.code) {
                    el.classList.add('selected');
                }

                el.innerHTML = `
                    <div class="code-badge">${std.code}</div>
                    <div>${std.desc}</div>
                `;

                el.onclick = () => {
                    // Deselect others
                    document.querySelectorAll('#subjectStandardsList .standard-item').forEach(i => i.classList.remove('selected'));
                    el.classList.add('selected');
                    selectedSubjectStd = std;
                    selectedSubject = subject;
                };

                container.appendChild(el);
            });
        }

        function renderLibraryStandards() {
            const container = document.getElementById('libStandardsList');
            // Assuming "ë„ì„œê´€/ì •ë³´ (ë„ì •)" key exists as per data file creation
            const standards = standardsData["ë„ì„œê´€/ì •ë³´ (ë„ì •)"];

            if (!standards) return;

            standards.forEach(std => {
                const el = document.createElement('div');
                el.className = 'standard-item';
                if (selectedLibStd && selectedLibStd.code === std.code) {
                    el.classList.add('selected');
                }

                el.innerHTML = `
                    <div class="code-badge">${std.code}</div>
                    <div>${std.desc}</div>
                `;

                el.onclick = () => {
                    document.querySelectorAll('#libStandardsList .standard-item').forEach(i => i.classList.remove('selected'));
                    el.classList.add('selected');
                    selectedLibStd = std;
                };

                container.appendChild(el);
            });
        }

        function selectContext(text) {
            document.getElementById('customContext').value = text;
            // Visual feedback on chips
            document.querySelectorAll('.chip').forEach(c => {
                if (c.textContent === text) c.classList.add('selected');
                else c.classList.remove('selected');
            });
        }

        function nextStep(step) {
            // Validation
            if (step === 2 && !selectedSubjectStd) {
                alert('êµê³¼ ì„±ì·¨ê¸°ì¤€ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            if (step === 3 && !selectedLibStd) {
                alert('ë„ì„œê´€ ì„±ì·¨ê¸°ì¤€ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            if (step === 4) {
                const ctx = document.getElementById('customContext').value;
                if (!ctx.trim()) {
                    alert('ì‚¶ì˜ ë§¥ë½ì„ ì…ë ¥í•˜ê±°ë‚˜ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }
                contextText = ctx;
                updateSummary();
            }

            // Transition
            document.getElementById(`ind-${currentStep}`).classList.remove('active');
            document.getElementById(`ind-${currentStep}`).classList.add('completed');

            currentStep = step;
            showStep(currentStep);
        }

        function showStep(step) {
            document.querySelectorAll('.step-content').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.step-indicator').forEach(i => i.classList.remove('active'));

            document.getElementById(`step${step}`).classList.add('active');
            document.getElementById(`ind-${step}`).classList.add('active');
        }

        function printStep(n) {
            const printClass = `print-step-${n}`;

            // Auto-expand textareas for printing (to prevent clipping)
            const textareas = document.querySelectorAll('textarea');
            const originalHeights = [];
            textareas.forEach(ta => {
                originalHeights.push(ta.style.height);
                ta.style.height = 'auto'; // Reset
                ta.style.height = (ta.scrollHeight + 2) + 'px'; // Set to full content height
            });

            document.body.classList.add(printClass);

            // Use a slight timeout to ensure styles are applied
            setTimeout(() => {
                window.print();
                document.body.classList.remove(printClass);
                // Restore original heights
                textareas.forEach((ta, i) => {
                    ta.style.height = originalHeights[i];
                });
            }, 50);
        }

        function printAll() {
            // Auto-expand textareas for printing
            const textareas = document.querySelectorAll('textarea');
            const originalHeights = [];
            textareas.forEach(ta => {
                originalHeights.push(ta.style.height);
                ta.style.height = 'auto';
                ta.style.height = (ta.scrollHeight + 2) + 'px';
            });

            document.body.classList.add('print-all');

            setTimeout(() => {
                window.print();
                document.body.classList.remove('print-all');
                textareas.forEach((ta, i) => {
                    ta.style.height = originalHeights[i];
                });
            }, 50);
        }

        function prevStep(step) {
            document.getElementById(`ind-${currentStep}`).classList.remove('active');
            document.getElementById(`ind-${currentStep}`).classList.remove('completed');

            currentStep = step;
            showStep(currentStep);
        }

        // Questions Data from Ontology (Reclassified into 3 types)
        const questionTypes = {
            factual: {
                label: " ì‚¬ì‹¤ì  ì§ˆë¬¸",
                characteristic: "íŠ¹ì •í•œ ì‚¬ì‹¤ì´ë‚˜ ì •ë‹µì„ ìš”êµ¬í•˜ë©°, ì§€ì‹ì„ í™•ì¸í•˜ëŠ” ì§ˆë¬¸",
                templates: ["{ëŒ€ìƒ}ì˜ ì •ì˜ëŠ” ë¬´ì—‡ì¸ê°€?", "{ì‚¬ê±´}ì€ ì–¸ì œ ì¼ì–´ë‚¬ëŠ”ê°€?", "{ê³¼ì •}ì„ ìˆœì„œëŒ€ë¡œ ë‚˜ì—´í•œë‹¤ë©´?", "{ìˆ˜ì¹˜} í˜¹ì€ {ê²°ê³¼}ëŠ” ë¬´ì—‡ì¸ê°€?"]
            },
            conceptual: {
                label: "ê°œë…ì  ì§ˆë¬¸",
                characteristic: "ê°œë… ê°„ì˜ ê´€ê³„ë¥¼ íƒêµ¬í•˜ê³  ì›ë¦¬ë¥¼ ì´í•´í•˜ëŠ” ì§ˆë¬¸",
                templates: ["{ê°œë…A}ì™€ {ê°œë…B}ëŠ” ì–´ë–¤ ìƒí˜¸ì‘ìš©ì„ í•˜ëŠ”ê°€?", "{ëŒ€ìƒ}ì˜ ë³¸ì§ˆì ì¸ ì›ë¦¬ëŠ” ë¬´ì—‡ì¸ê°€?", "{í˜„ìƒ}ì˜ ì›ì¸ê³¼ ê²°ê³¼ë¥¼ ë¶„ì„í•œë‹¤ë©´?", "{ì‚¬ë¡€}ë¥¼ í†µí•´ ì•Œ ìˆ˜ ìˆëŠ” ë³´í¸ì  ê°€ì¹˜ëŠ”?"]
            },
            controversial: {
                label: "ë…¼ìŸì  ì§ˆë¬¸",
                characteristic: "ë‹¤ì–‘í•œ ê´€ì ì´ ì¶©ëŒí•˜ë©° ê°€ì¹˜ íŒë‹¨ì„ ìš”êµ¬í•˜ëŠ” ì§ˆë¬¸",
                templates: ["{ìŸì }ì— ëŒ€í•´ ì–´ë–¤ ì…ì¥ì„ ì§€ì§€í•˜ëŠ”ê°€?", "{ì´í•´ê´€ê³„ì}ë“¤ì˜ ì…ì¥ì´ ë‹¤ë¥¸ ì´ìœ ëŠ”?", "{ì •ì±…}ì˜ ê¸ì •ì /ë¶€ì •ì  ì¸¡ë©´ì€?", "ë§Œì•½ {ì¡°ê±´}ì´ ë°”ë€ë‹¤ë©´ ì–´ë–¤ ëŒ€ì•ˆì´ ê°€ëŠ¥í•œê°€?"]
            }
        };

        function generateSpecificQuestion(type) {
            if (!questionTypes[type]) return;
            const templates = questionTypes[type].templates;
            const template = templates[Math.floor(Math.random() * templates.length)];

            let result = template;
            if (selectedSubjectStd) {
                const keywords = selectedSubjectStd.desc.split(' ').filter(w => w.length > 1).slice(0, 2).join(', ');
                result = result.replace(/{ëŒ€ìƒ}|{ê°œë…[A-B]}|{ì£¼ì œ}|{í˜„ìƒ}|{ê°œë…A}|{ê°œë…B}|{ìŸì }|{ê³¼ì •}/g, keywords);
            }

            const idMap = { factual: 'qFactual', conceptual: 'qConceptual', controversial: 'qControversial' };
            document.getElementById(idMap[type]).value = result;
        }

        // GRASPS Template Data from Ontology
        const graspsTemplates = {
            goal: "ì—¬ëŸ¬ë¶„ì˜ ê³¼ì œëŠ” [ìˆ˜ì—… ì œëª©]ì´ë©°, ëª©í‘œëŠ” [í‰ê°€ê³¼ì œ]í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.",
            role: "ì—¬ëŸ¬ë¶„ì€ [ì „ë¬¸ê°€/ì´í•´ê´€ê³„ì]ì´ë©°, [íŠ¹ì • ì„ë¬´]ë¥¼ ìš”êµ¬ë°›ì•˜ìŠµë‹ˆë‹¤.",
            audience: "ì—¬ëŸ¬ë¶„ì€ ì´ ì£¼ì œë¥¼ [ê´€ë ¨ ì§‘ë‹¨]ì—ê²Œ ì„¤ëª…í•  ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.",
            situation: "ì´ ë¬¸ì œë¥¼ í•´ê²°í•  ë•Œ ì¤‘ìš”í•˜ê²Œ ë‹¤ë£¨ì–´ì•¼ í•  ë‚´ìš©ì€ [íƒêµ¬ì§ˆë¬¸]ì…ë‹ˆë‹¤.",
            product: "ì—¬ëŸ¬ë¶„ì€ [ëª©í‘œ]ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ [ê²°ê³¼ë¬¼]ì„ ë§Œë“¤ê±°ë‚˜ ê°œë°œí•  í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤.",
            standards: "ì—¬ëŸ¬ë¶„ì˜ ìˆ˜í–‰ ê²°ê³¼ë¬¼ì€ [ì„±ì·¨ê¸°ì¤€ê³¼ ë‚´ìš©ìš”ì†Œ]ë¥¼ í¬í•¨í•˜ê³  ìˆì–´ì•¼ í•©ë‹ˆë‹¤."
        };

        function generateGRASPS() {
            if (!selectedSubjectStd || !selectedLibStd) {
                alert('ì„±ì·¨ê¸°ì¤€ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }

            const title = document.getElementById('lessonTitle').value || "ìˆ˜ì—… ì£¼ì œ";
            const ctx = document.getElementById('customContext').value || "ê´€ë ¨ ì£¼ì œ";
            const keywords = selectedSubjectStd.desc.split(/[ ,.()]+/).filter(w => w.length > 1).slice(0, 2).join(', ');

            // Get Inquiry Questions from Step 4
            const qFact = document.getElementById('qFactual').value.trim();
            const qConc = document.getElementById('qConceptual').value.trim();
            const qCont = document.getElementById('qControversial').value.trim();
            const allQuestions = [qFact, qConc, qCont].filter(q => q).join(' / ') || "íƒêµ¬ ì§ˆë¬¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.";

            // Role Heuristics
            const roleMap = {
                'ê³¼í•™': 'í™˜ê²½ ê³¼í•™ì ë° ê¸°ìˆ  ì—°êµ¬ì›',
                'ì‚¬íšŒ': 'ì§€ì—­ì‚¬íšŒ ì •ì±… ë¶„ì„ê°€',
                'êµ­ì–´': 'ë¹„í‰ê°€ ë° ì‘ê°€',
                'ë„ë•': 'ìœ¤ë¦¬ ìœ„ì›íšŒ ìœ„ì›',
                'ì§„ë¡œ': 'ë¯¸ë˜ ì„¤ê³„ ì»¨ì„¤í„´íŠ¸',
                'ì—­ì‚¬': 'ì—­ì‚¬ ë¬¸í™” íë ˆì´í„°'
            };
            const roleName = roleMap[selectedSubject] || 'ì°½ì˜ì ì¸ ë¬¸ì œ í•´ê²° ì „ë¬¸ê°€';

            // Get Instructional Intent from Step 4
            const intent = document.getElementById('instructionalIntent').value.trim() || `${keywords}ì˜ ì›ë¦¬ë¥¼ í™œìš©í•˜ì—¬ ì‹¤ì œ ë¬¸ì œë¥¼ í•´ê²°`;

            // Goal
            document.getElementById('g_goal').value = graspsTemplates.goal
                .replace("[ìˆ˜ì—… ì œëª©]", title)
                .replace("[í‰ê°€ê³¼ì œ]", intent);

            // Get Evaluation Task from Step 4
            const evaluationTask = document.getElementById('graspsTask').value.trim() || `${ctx}ì™€(ê³¼) ê´€ë ¨ëœ ëŒ€ì•ˆ ì œì‹œ ë° ì‹¤í–‰`;

            // Role
            document.getElementById('g_role').value = graspsTemplates.role
                .replace("[ì „ë¬¸ê°€/ì´í•´ê´€ê³„ì]", roleName)
                .replace("[íŠ¹ì • ì„ë¬´]", evaluationTask);

            // Audience
            document.getElementById('g_audience').value = graspsTemplates.audience
                .replace("[ìˆ˜ì—… ì œëª© ê´€ë ¨ ì§‘ë‹¨]", "ë³¸ ì£¼ì œì— ê´€ì‹¬ ìˆëŠ” í•™êµ ê³µë™ì²´ ë° ì „ë¬¸ê°€ ê·¸ë£¹");

            // Situation
            document.getElementById('g_situation').value = graspsTemplates.situation
                .replace("[íƒêµ¬ì§ˆë¬¸]", allQuestions);

            // Product
            document.getElementById('g_product').value = graspsTemplates.product
                .replace("[ëª©í‘œ]", "ë¬¸ì œë¥¼ íš¨ê³¼ì ìœ¼ë¡œ í•´ê²°")
                .replace("[ê²°ê³¼ë¬¼]", "ë©€í‹°ë¯¸ë””ì–´ ë³´ê³ ì„œ, ìº í˜ì¸ ì›¹ì§„ ë˜ëŠ” ì •ì±… ì œì•ˆì„œ");

            // Get Content Elements from Step 4
            const kLib = document.getElementById('contentKnowledgeLib').value.trim();
            const kSub = document.getElementById('contentKnowledgeSub').value.trim();
            const pLib = document.getElementById('contentProcessLib').value.trim();
            const pSub = document.getElementById('contentProcessSub').value.trim();
            const vLib = document.getElementById('contentValueLib').value.trim();
            const vSub = document.getElementById('contentValueSub').value.trim();

            const allContentElements = [kLib, kSub, pLib, pSub, vLib, vSub]
                .filter(val => val !== "")
                .join(', ');

            const contentString = allContentElements
                ? `${allContentElements} ë“± í•µì‹¬ ë‚´ìš© ìš”ì†Œ`
                : "ì„ íƒëœ í•µì‹¬ ë‚´ìš© ìš”ì†Œ";

            // Standards
            document.getElementById('g_standards').value = graspsTemplates.standards
                .replace("[ì„±ì·¨ê¸°ì¤€ê³¼ ë‚´ìš©ìš”ì†Œ]", `${selectedSubjectStd.code}(${keywords}), ${selectedLibStd.code} ë° ${contentString}`);
        }

        function generateRubric() {
            if (!selectedSubjectStd || !selectedLibStd) {
                alert('ì„±ì·¨ê¸°ì¤€ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }

            const sub = selectedSubjectStd.desc;
            const lib = selectedLibStd.desc;

            // Extract keywords from subject standard (smart keyword extraction)
            const subKeywords = sub.split(/[ ,.()]+/)
                .filter(w => w.length > 1 && !['ì´í•´í•˜ê³ ', 'ì¸ì‹í•œë‹¤', 'ì„¤ëª…í• ', 'ìˆ˜í–‰í• ', 'í†µí•´'].includes(w))
                .slice(0, 3).join(', ');

            // Get Content Elements from Step 4 (Merged Lib and Sub)
            const kLib = document.getElementById('contentKnowledgeLib').value.trim();
            const kSub = document.getElementById('contentKnowledgeSub').value.trim();
            const elementK = [kLib, kSub].filter(x => x).join(' / ') || sub;

            const pLib = document.getElementById('contentProcessLib').value.trim();
            const pSub = document.getElementById('contentProcessSub').value.trim();
            const elementS = [pLib, pSub].filter(x => x).join(' / ') || sub;

            const vLib = document.getElementById('contentValueLib').value.trim();
            const vSub = document.getElementById('contentValueSub').value.trim();
            const elementA = [vLib, vSub].filter(x => x).join(' / ') || "ì ê·¹ì ì¸ íƒêµ¬ íƒœë„";

            // Prepare merged labels (Content Element + Standard Keywords)
            const labelK = elementK.includes('(') ? elementK : `${elementK} (${subKeywords})`;
            const labelS = elementS.includes('(') ? elementS : `${elementS} (${subKeywords})`;
            const labelA = elementA.includes('(') ? elementA : `${elementA} (${subKeywords})`;

            // Enhanced generative logic incorporating Content Elements + Standards Keywords
            const rubricData = {
                K: { // Knowledge
                    H: `${labelK}ì˜ í•µì‹¬ ê°œë…ì„ ì™„ë²½íˆ ì´í•´í•˜ê³ , ${lib}ì˜ ì •ë³´ ê²€ìƒ‰ ë° ë¶„ì„ ì›ë¦¬ì™€ ì—°ê³„í•˜ì—¬ ê¹Šì´ ìˆê²Œ ì„¤ëª…í•  ìˆ˜ ìˆìŒ.`,
                    M: `${labelK}ì˜ ì£¼ìš” ë‚´ìš©ì„ íŒŒì•…í•˜ê³  ìˆìœ¼ë©°, ${lib}ì˜ íƒêµ¬ ì ˆì°¨ë¥¼ ì ì ˆíˆ ì ìš©í•  ìˆ˜ ìˆìŒ.`,
                    L: `${labelK}ë‚˜ ${lib}ì˜ ì§€ì‹ ìˆ˜ì¤€ì´ ë‹¨í¸ì ì´ë©°, ê°œë… ê°„ì˜ ê´€ê³„ë¥¼ íŒŒì•…í•˜ëŠ” ë° ì–´ë ¤ì›€ì´ ìˆìŒ.`
                },
                S: { // Skill
                    H: `${labelS} ê³¼ì •ì—ì„œ ìš”êµ¬í•˜ëŠ” í•µì‹¬ ê¸°ëŠ¥ì„ ìˆ™ë‹¬í•˜ì—¬ ìˆ˜í–‰í•˜ê³ , ì •ë³´ í™œìš© ëŠ¥ë ¥(íƒìƒ‰-ë¶„ì„-ì‚°ì¶œ)ì„ í†µí•©ì ìœ¼ë¡œ ë°œíœ˜í•´ íƒì›”í•œ ê²°ê³¼ë¬¼ì„ ë§Œë“¤ì–´ëƒ„.`,
                    M: `${labelS} í•´ê²° ê³¼ì •ì— ì ê·¹ì ìœ¼ë¡œ ì°¸ì—¬í•˜ë©°, ì•ˆë‚´ëœ ì •ë³´ í™œìš© ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì™„ì„±ë„ ìˆëŠ” ì‚°ì¶œë¬¼ì„ ì œì‘í•¨.`,
                    L: `${labelS}ë¥¼ ìˆ˜í–‰í•˜ëŠ” ê¸°ìˆ ì  ìˆ™ë ¨ë„ê°€ ë‚®ìœ¼ë©°, ì •ë³´ ê¸°ê¸°ë‚˜ ìë£Œ í™œìš© ì‹œ ì§€ì†ì ì¸ ë„ì›€ì´ í•„ìš”í•¨.`
                },
                A: { // Attitude
                    H: `${labelA}ì˜ ê°€ì¹˜ë¥¼ ë‚´ë©´í™”í•˜ì—¬ ì£¼ë„ì ìœ¼ë¡œ íƒêµ¬í•˜ë©°, ì§€ì‹ ì •ë³´ ë³´ì•ˆ ë° ì €ì‘ê¶Œ ìœ¤ë¦¬ë¥¼ ì¤€ìˆ˜í•˜ê³  í˜‘ë ¥ì  íƒœë„ë¥¼ ì¼ê´€ë˜ê²Œ ë³´ì„.`,
                    M: `${labelA} ê´€ë ¨ í™œë™ì— ì„±ì‹¤íˆ ì°¸ì—¬í•˜ê³ , ì •ë³´ í™œìš© ìœ¤ë¦¬ì˜ ì¤‘ìš”ì„±ì„ ì¸ì‹í•˜ë©° ë™ë£Œì™€ í˜‘ë ¥í•˜ë ¤ ë…¸ë ¥í•¨.`,
                    L: `${labelA} ê´€ë ¨ í™œë™ì— ì†Œê·¹ì ì´ë©°, ì •í•´ì§„ ëª¨ë‘  ê·œì¹™ì´ë‚˜ ì •ë³´ í™œìš©ì˜ ê¸°ì´ˆì ì¸ ì—í‹°ì¼“ ì¤€ìˆ˜ê°€ ë¶€ì¡±í•¨.`
                }
            };

            // Fill textareas
            document.getElementById('rubricK_H').value = rubricData.K.H;
            document.getElementById('rubricK_M').value = rubricData.K.M;
            document.getElementById('rubricK_L').value = rubricData.K.L;

            document.getElementById('rubricS_H').value = rubricData.S.H;
            document.getElementById('rubricS_M').value = rubricData.S.M;
            document.getElementById('rubricS_L').value = rubricData.S.L;

            document.getElementById('rubricA_H').value = rubricData.A.H;
            document.getElementById('rubricA_M').value = rubricData.A.M;
            document.getElementById('rubricA_L').value = rubricData.A.L;
        }

        function updateSummary() {
            document.getElementById('summarySubject').innerHTML = `
                <span style="font-weight:bold; color:var(--primary-color)">[${selectedSubject}]</span> 
                ${selectedSubjectStd.code} ${selectedSubjectStd.desc}
            `;
            document.getElementById('summaryLib').innerHTML = `
                ${selectedLibStd.code} ${selectedLibStd.desc}
            `;
            document.getElementById('summaryContext').textContent = contextText;
        }

        // --- Integrated Download Function ---
        function downloadIntegratedPlan() {
            // 1. Prepare Export Container
            const exportContainer = document.createElement('div');
            exportContainer.className = 'exporting';

            // 2. Clone Steps 4, 5, 6
            const steps = [
                document.getElementById('step4'),
                document.getElementById('step5'),
                document.getElementById('step6')
            ];

            steps.forEach((step, idx) => {
                const clone = step.cloneNode(true);
                clone.style.display = 'block';
                clone.style.marginBottom = '40px';
                clone.style.padding = '0';
                clone.style.boxShadow = 'none';

                // Remove navigation and UI buttons from clone
                const uiElements = clone.querySelectorAll('.btn-container, button:not(.btn-admin), .btn-admin, .no-export');
                uiElements.forEach(el => el.remove());

                // Transform input/textarea to text in clone
                const originalControls = step.querySelectorAll('input, textarea');
                const clonedControls = clone.querySelectorAll('input, textarea');

                clonedControls.forEach((control, cIdx) => {
                    const original = originalControls[cIdx];
                    const val = original.value || '';
                    const wrapper = document.createElement('div');
                    wrapper.style.whiteSpace = 'pre-wrap';
                    wrapper.style.padding = '8px';
                    wrapper.style.border = '1px solid #e2e8f0';
                    wrapper.style.borderRadius = '4px';
                    wrapper.style.marginBottom = '10px';
                    wrapper.style.minHeight = '1.2em';
                    wrapper.style.backgroundColor = '#fff';
                    wrapper.textContent = val;

                    control.parentNode.replaceChild(wrapper, control);
                });

                // Add Page Header
                const header = document.createElement('h1');
                header.textContent = `ë‹¨ê³„ ${idx + 4}`;
                header.style.color = '#6366f1';
                header.style.borderBottom = '2px solid #6366f1';
                header.style.paddingBottom = '10px';
                header.style.marginTop = '40px';

                const stepWrapper = document.createElement('div');
                stepWrapper.className = 'step-wrapper';
                stepWrapper.appendChild(header);
                stepWrapper.appendChild(clone);
                exportContainer.appendChild(stepWrapper);
            });

            // 3. Create Full HTML Document
            const title = document.getElementById('lessonTitle').value || 'í˜‘ë ¥ìˆ˜ì—…_ì„¤ê³„ì•ˆ';
            const htmlContent = `
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>${title}</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; padding: 40px; color: #1e293b; line-height: 1.6; background-color: #fff; }
        h1, h2, h3 { color: #6366f1; }
        .summary-box { background-color: #f1f5f9; padding: 20px; border-radius: 8px; border-left: 4px solid #10b981; margin-bottom: 20px; }
        .summary-label { font-weight: bold; color: #64748b; font-size: 0.85rem; text-transform: uppercase; }
        .summary-content { font-size: 1.1rem; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { border: 1px solid #bfdbfe; padding: 12px; text-align: left; }
        th { background-color: #f8fafc; color: #64748b; font-size: 0.9rem; }
        .code-badge { background-color: #6366f1; color: white; padding: 4px 8px; border-radius: 4px; font-weight: bold; font-size: 0.8rem; display: inline-block; margin-bottom: 4px; }
        .design-grid { display: grid; gap: 20px; }
        
        @media print { 
            .no-print { display: none; } 
            .step-wrapper { 
                page-break-before: always; 
            }
            .step-wrapper:first-child {
                page-break-before: auto;
            }
        }
    </style>
</head>
<body>
    <header style="text-align:center; margin-bottom: 50px;">
        <h1 style="font-size: 2.5rem; margin-bottom:10px;">í˜‘ë ¥ìˆ˜ì—… ì„¤ê³„ í†µí•© ë³´ê³ ì„œ</h1>
        <p style="color: #64748b;">${new Date().toLocaleDateString()}</p>
    </header>
    ${exportContainer.innerHTML}
</body>
</html>`;

            // 4. Trigger Download
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${title.replace(/\s+/g, '_')}_í†µí•©ì„¤ê³„ì•ˆ.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

    </script>
</body>

</html>